<?xml-stylesheet type="text/css" href="/theme/custom.css"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 350"> <!-- Removed width/height -->
    <defs>
        <marker id="arrowhead" class="marker-arrowhead marker-base" viewBox="0 0 10 10" refX="5" refY="5"
                markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z"/>
        </marker>
        <marker id="arrowhead-pointer" class="marker-arrowhead-pointer marker-base" viewBox="0 0 10 10" refX="5"
                refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z"/>
        </marker>
        <marker id="arrowhead-bidir" class="marker-arrowhead marker-base" viewBox="0 0 10 10" refX="5" refY="5"
                markerWidth="6" markerHeight="6" orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z"/>
        </marker>
    </defs>
    <text x="10" y="25" class="step-label">Context System Illustration</text>

    <!-- State 1: After push_context -->
    <text x="150" y="50" class="text-color-muted" text-anchor="middle">After push_context</text> <!-- Adjusted Y -->
    <g class="node active" transform="translate(150, 100)">
        <circle r="20"></circle>
        <text class="node-label">A</text>
    </g>
    <g class="node" transform="translate(250, 100)">
        <circle r="20"></circle>
        <text class="node-label">B</text>
    </g>
    <g class="node" transform="translate(350, 100)">
        <circle r="20"></circle>
        <text class="node-label">C</text>
    </g>
    <line class="edge directed" x1="170" y1="100" x2="230" y2="100"/>
    <text class="edge-label" x="200" y="90">Follows</text>
    <line class="edge directed" x1="270" y1="100" x2="330" y2="100"/>
    <text class="edge-label" x="300" y="90">Created</text>

    <!-- Context Box 1 -->
    <g transform="translate(150, 170)"> <!-- Adjusted Y -->
        <rect class="index-box" x="-75" y="-20" width="150" height="40"/>
        <text class="index-value range" y="5">username: alice</text>
    </g>
    <!-- Link Context 1 -->
    <line class="index-pointer" x1="150" y1="120" x2="150" y2="150" marker-start="url(#arrowhead-bidir)"
          marker-end="url(#arrowhead-bidir)" stroke-dasharray="none"/> <!-- Adjusted Y -->
    <text x="250" y="175" class="text-color-muted" font-size="12px">Still at A, with context</text> <!-- Adjusted Y -->

    <!-- State 2: Later in traversal -->
    <text x="150" y="230" class="text-color-muted" text-anchor="middle">Later in Traversal</text> <!-- Adjusted Y -->
    <g class="node" transform="translate(150, 270)"> <!-- Adjusted Y -->
        <circle r="20"></circle>
        <text class="node-label">A</text>
    </g>
    <g class="node active" transform="translate(250, 270)"> <!-- Adjusted Y -->
        <circle r="20"></circle>
        <text class="node-label">B</text>
    </g>
    <g class="node" transform="translate(350, 270)"> <!-- Adjusted Y -->
        <circle r="20"></circle>
        <text class="node-label">C</text>
    </g>
    <line class="edge directed" x1="170" y1="270" x2="230" y2="270"/> <!-- Adjusted Y -->
    <text class="edge-label" x="200" y="260">Follows</text> <!-- Adjusted Y -->
    <line class="edge directed" x1="270" y1="270" x2="330" y2="270"/> <!-- Adjusted Y -->
    <text class="edge-label" x="300" y="260">Created</text> <!-- Adjusted Y -->

    <!-- Context Box 2 -->
    <g transform="translate(250, 330)"> <!-- Adjusted Y -->
        <rect class="index-box" x="-75" y="-20" width="150" height="40"/>
        <text class="index-value range" y="5">username: alice</text>
    </g>
    <!-- Link Context 2 -->
    <line class="index-pointer" x1="250" y1="290" x2="250" y2="310" marker-start="url(#arrowhead-bidir)"
          marker-end="url(#arrowhead-bidir)" stroke-dasharray="none"/> <!-- Adjusted Y -->
    <text x="350" y="335" class="text-color-muted" font-size="12px">Context moves to B</text> <!-- Adjusted Y -->

</svg>
