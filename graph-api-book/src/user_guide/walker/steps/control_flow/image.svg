<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="600" height="350" viewBox="0 0 600 350" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect x="0" y="0" width="600" height="350" fill="#f9f9f9" />
  
  <!-- Title -->
  <text x="300" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">ControlFlow Step Operation</text>
  
  <!-- Input Stream -->
  <text x="100" y="70" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Input Stream</text>
  <line x1="50" y1="100" x2="250" y2="100" stroke="#2e3440" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Input Elements -->
  <circle cx="80" cy="100" r="15" fill="#88c0d0" stroke="#2e3440" stroke-width="1" />
  <text x="80" y="105" font-family="Arial" font-size="12" text-anchor="middle">A</text>
  <circle cx="130" cy="100" r="15" fill="#88c0d0" stroke="#2e3440" stroke-width="1" />
  <text x="130" y="105" font-family="Arial" font-size="12" text-anchor="middle">B</text>
  <circle cx="180" cy="100" r="15" fill="#88c0d0" stroke="#2e3440" stroke-width="1" />
  <text x="180" y="105" font-family="Arial" font-size="12" text-anchor="middle">C</text>
  <circle cx="230" cy="100" r="15" fill="#88c0d0" stroke="#2e3440" stroke-width="1" />
  <text x="230" y="105" font-family="Arial" font-size="12" text-anchor="middle">D</text>

  <!-- ControlFlow Step Box -->
  <rect x="250" y="75" width="100" height="50" rx="5" ry="5" fill="#ebcb8b" stroke="#2e3440" stroke-width="2" />
  <text x="300" y="105" font-family="Arial" font-size="12" text-anchor="middle">control_flow</text>
  
  <!-- Output Stream -->
  <text x="450" y="70" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Output Stream</text>
  <line x1="350" y1="100" x2="550" y2="100" stroke="#2e3440" stroke-width="2" marker-end="url(#arrowhead)" />

  <!-- Element Processing Paths -->
  <!-- Element A: Skipped -->
  <line x1="300" y1="125" x2="300" y2="160" stroke="#d8dee9" stroke-width="2" stroke-dasharray="4,2" />
  <line x1="300" y1="160" x2="250" y2="160" stroke="#d8dee9" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrowhead_skip)" />
  <circle cx="220" cy="160" r="15" fill="#d8dee9" stroke="#4c566a" stroke-width="1" stroke-dasharray="4,2" />
  <text x="220" y="165" font-family="Arial" font-size="12" text-anchor="middle" fill="#4c566a">A</text>
  <text x="220" y="185" font-family="Arial" font-size="10" text-anchor="middle" fill="#4c566a">Skipped</text>
  <text x="300" y="145" font-family="Arial" font-size="10" text-anchor="middle" fill="#4c566a">Continue(None)</text>

  <!-- Element B: Kept -->
  <circle cx="400" cy="100" r="15" fill="#88c0d0" stroke="#2e3440" stroke-width="1" />
  <text x="400" y="105" font-family="Arial" font-size="12" text-anchor="middle">B</text>
  <text x="400" y="125" font-family="Arial" font-size="10" text-anchor="middle">Kept</text>
  <text x="400" y="80" font-family="Arial" font-size="10" text-anchor="middle">Continue(Some)</text>

  <!-- Element C: Kept & Break -->
  <circle cx="470" cy="100" r="15" fill="#bf616a" stroke="#2e3440" stroke-width="1" />
  <text x="470" y="105" font-family="Arial" font-size="12" text-anchor="middle">C</text>
  <text x="470" y="125" font-family="Arial" font-size="10" text-anchor="middle">Kept & Break</text>
  <text x="470" y="80" font-family="Arial" font-size="10" text-anchor="middle" fill="#bf616a">Break(Some)</text>

  <!-- Break Indicator -->
  <line x1="495" y1="90" x2="525" y2="110" stroke="#bf616a" stroke-width="3" />
  <line x1="495" y1="110" x2="525" y2="90" stroke="#bf616a" stroke-width="3" />
  <text x="510" y="130" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle" fill="#bf616a">STOP</text>

  <!-- Element D: Not Processed -->
   <circle cx="560" cy="100" r="15" fill="#eceff4" stroke="#adb5bd" stroke-width="1" stroke-dasharray="4,2" />
   <text x="560" y="105" font-family="Arial" font-size="12" text-anchor="middle" fill="#adb5bd">D</text>
   <text x="560" y="125" font-family="Arial" font-size="10" text-anchor="middle" fill="#adb5bd">Not Processed</text>

  <!-- Legend -->
  <rect x="50" y="220" width="500" height="110" rx="5" ry="5" fill="#eceff4" stroke="#d8dee9" stroke-width="1" />
  <text x="300" y="240" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">ControlFlow Predicate Outcomes</text>
  
  <circle cx="80" cy="265" r="10" fill="#d8dee9" stroke="#4c566a" stroke-width="1" stroke-dasharray="4,2" />
  <text x="100" y="270" font-family="Arial" font-size="11" text-anchor="left">`ControlFlow::Continue(None)`: Element is skipped, traversal continues.</text>
  
  <circle cx="80" cy="290" r="10" fill="#88c0d0" stroke="#2e3440" stroke-width="1" />
  <text x="100" y="295" font-family="Arial" font-size="11" text-anchor="left">`ControlFlow::Continue(Some(element))`: Element is kept, traversal continues.</text>
  
  <circle cx="80" cy="315" r="10" fill="#bf616a" stroke="#2e3440" stroke-width="1" />
  <text x="100" y="320" font-family="Arial" font-size="11" text-anchor="left">`ControlFlow::Break(Some(element))` / `Break(None)`: Element might be kept, traversal stops immediately.</text>

  <!-- Definitions for Markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2e3440" />
    </marker>
    <marker id="arrowhead_skip" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#d8dee9" />
    </marker>
  </defs>
</svg>
